---
title: 常见TLS安全名词

# []: (new Date()).toJSON()
date: '2021-10-30T10:31:24.683Z'
---

> 这里假设你对 SSL(TLS)、(非)对称加密 有一个基础的认知，知道它们相互之间的关系、特点。

# 一个 TLS 会话

以经典的 A(lice)、B(ob)、E(ve)模型来辅助说明。

## 1.1. 核心目标

A、B 建立一个安全的会话，最直接的方法就是在信息发出之前，用同一个安全的算法、同一份安全的密钥进行加密。

但如果 A、B 相隔千里，是第一次通信，他们之间怎么用“同一个安全的算法、同一份安全的密钥”？

### 1.1.1. 密钥协商

A、B 需要一份密钥来开启通信，但交换密钥又需要一次通信，似乎陷入死循环了。这时候，该介绍另一位朋友了，非对称加密。A、B 可以先在网络上公开自己的公钥，用公钥加密的信息，只能被对应的私钥解密。如果 A 要找 B，那么 A 就把一个安全的密钥（足够随机足够长），用 B 的公钥加密后发给 B，这样 AB 之间就拥有了“同一份安全的密钥”。

> 为什么 A、B 不直接用非对称算法、密钥对进行通信？

> 因为同有效位<sup>[1]</sup>情况下，非对称加密的速度远比对称加密慢<sup>[2]</sup>。

### 1.1.2. session-key(会话密钥)

上一步得到的密钥，一般就称之为会话密钥(session-key)，A 和 B 发出的消息都会用这个会话密钥加密后再发送。

## 1.2. what else?

我们好像已经完成了所有的任务了？非对称加密解决了密钥协商，对称密钥保护通信内容。

### 1.2.1. 密钥交换

回顾“密钥协商”段落，会话密钥的协商是否安全，很大程度上取决于非堆成加密时私钥的安全。私钥被窃取，协商过程就如同明文通信了；这种依赖另一种秘密信道来传递密钥的手段其实称之为“密钥分发”(key distribution)更贴切，它的特点是分发的安全性取决于分发信道的安全性。而互联网中公私钥的签发权力集中于权力机构或少数企业手中，这显然有悖互联网开放互联的出发点。

密钥交换(key exchange)就是在这种局面下被提出来的。它的目标于密钥分发一致，致力于在不安全的网络中取得共识，完成秘密共享。与密钥分发最大的区别在于，密钥协商里密钥不会通过网络传递。

既然不能直接传递密钥，要怎么达成共识？最常见办法就是传递密钥的“特征”。用一个通俗的例子解释：颜料混合；我们可以无法从混合好的颜料中分离出混合前的颜料，同时我们可以用任意顺序来加入颜料，顺序并不会影响最终的得到的混合颜色。

### 1.2.2. 颜料混合

通过先协商一种基础颜色（公开），A 和 B 相互传递自己的秘密颜色与公共颜色的混合样本，当 A 和 B 收到对方送来的样本，再把自己的秘密颜色加进去，这样 AB 最终都能得到同一种颜色，但却不需要把秘密颜色放在网络上传递。假设 E 把 A 和 B 的混合样本都各自偷掉一点，再混合起来，他也只能拿到 `2(普通颜色):1(A的秘密颜色):1(B的秘密颜色)` 的混合颜色，并不能拿到 A 和 B 以正确比例混合得到的颜色。

### 1.2.3. Diffie–Hellman key exchange(DH)

这个以颜料为例子的方法，也是 Diffie–Hellman key exchange(简称 D-H) 原理的通俗解释。这种手段有两个基础条件(特征)：所传递的特征信息不能用来反推输入的秘密，以及不能只用两者的特征信息就推算得到最终秘密。

DH 密钥交换协议最早在 1976 的一篇论文<sup>[3]</sup>中命名、正式提出，它的安全性由一个简单的数学问题来保证: `log`<sub>`a`</sub>`b`<sup>[4]</sup>。对于特定的 a 值，比如 2、10，我们已经找到了一些技巧来得到快速计算结果，但对于任意 a 值，我们尚未找到有效的通用解法来求解，这个问题也被称为 discrete logarithm problem(离散对数问题)。DH 模型就是利用这个数学难题，对随机的、公开协商的 <i style="color: blue">g</i> 计算 <i><i style="color: blue">b</i> = <i style="color: blue">g<sup style="color: red">a</sup></i></i> 并传递 <i style="color: blue">b</i>。假设有人监听了这个通信，为了要得到 <i style="color: red">a</i> 值它就必须要求解<i>log<sub style="color: blue">g</sub>b</i> 这个刚刚介绍的离散对数问题；变相地，我们保护了 <i style="color: red">a</i> 值。

1. 通信的双发先交换两个公共参数<i style="color: blue">p</i>、<i style="color: blue">g</i>
2. A 取一个秘密值 <i style="color: red">a</i>，计算<wbr /><i>x<sub>a</sub> = <i style="color: blue">g</i><sup style="color: red">a</sup> mod <span style="color: blue">p</span><i>
3. B 也取一个秘密值 <i style="color: red">b</i>，以类似的过程算出 <i>x<sub>b</sub></i>
4. 双方交换各自的 <i>x</i> 值
5. 以 A 为例，A 接受到 <i>x<sub>b</sub></i>后，计算 <i><i style="color: red">s</i> = x<sub>b</sub><sup style="color: red">a</sup> mod <span style="color: blue">p</span></i>
6. 类似的，B 得到 <i>x<sub>a</sub></i> 后运用同样的公式就能得到同样的 <i style="color: red">s</i> 值
7. A 和 B 协商共享了密钥 <i style="color: red">s</i>

> 如同以上总结的，DH 的安全性还依赖一个条件： <i>x<sub>a</sub></i> 和 <i>x<sub>b</sub></i> 无法用来推导 <i style="color: red">s</i> 。

### 1.2.3. Elliptic-curve Diffie–Hellman(ECDH)

# 2. PFS

# 参考资料

- [1] [Key size difference between AES and RSA](https://security.stackexchange.com/a/38026)
- [2] [Speed Comparison of Popular Crypto Algorithms](https://cryptopp.com/benchmarks.html)
- [3] [New Directions in Cryptography (1976)](https://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.37.9720)
- [4] [Discrete logarithm](https://en.wikipedia.org/wiki/Discrete_logarithm)
- [一个藏在我们身边的巨型僵尸网络 Pink](https://blog.netlab.360.com/pinkbot)
