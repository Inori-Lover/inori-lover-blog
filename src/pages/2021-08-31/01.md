---
title: react是怎么react的

# []: (new Date()).toJSON()
date: '2021-08-31T13:07:16.533Z'
---

# 警告

这篇文章不应该被发出，但如果不幸我手贱发出来了，那可以直接跳转到末尾阅读原文。本记录作为一个阅读笔记，打算在完全阅读完毕、消化之后再做一次个人演绎的。

# 动机

react 的生命周期、常规优化手段、坑点都基本理解了，但还是不知道。想要理解 react 的整体运行架构，比如为什么 setState 就能动，为什么要做 fiber，做了跟没做有什么区别。

# react-app 从 jsx 书写到编译的流程

这是要造轮子需要知道的第一步骤。jsx 是一个类似 DSL 的特殊标记语言了，它需要被 babel/ts 等支持 jsx 的转译器转译成函数调用方可在普通 js 环境中运行(以 react@17 版的新格式为例[3]):

```jsx
function Foo() {
  return <p>foo</p>
}
```

```js
import { jsx } from 'react/jsx-runtime'

function Foo() {
  return jsx('p', { children: 'foo' }, undefined)
}
```

如果造轮子过程能将 jsx 的来源换成自己的那将事半功倍。`preact`等现有轮子已经帮我们把路闯平了，tsconfig 里提供 jsxFragmentFactory 这个选项可以指定一个包含“jsx-runtime”文件的路径（库），在编译时会将原来从 react 导入的内容切换为从指定路径里的内容。

```json
{
  "compilerOptions": {
    "jsx": "react-jsx",
    "jsxImportSource": "./demo"
  }
}
```

```js
import { jsx } from './demo/jsx-runtime'

function Foo() {
  return jsx('p', { children: 'foo' }, undefined)
}
```

# 参考

[1](Didact: a DIY guide to build your own React)[https://engineering.hexacta.com/didact-learning-how-react-works-by-building-it-from-scratch-51007984e5c5]
[2](Build your own React)[https://pomb.us/build-your-own-react/]
[3] (jsx)[https://www.typescriptlang.org/play?jsx=4#code/GYVwdgxgLglg9mABAMTnRAKAlIg3gKESMQCcBTKEEpAHgAcA+YNGgekfwF998g]
